<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<meta name='viewport' content="width=device-width,initial-scale=1,user-scalable=no" />
		<title>相册</title>
		<style>
			*{
				margin: 0;
				padding: 0;
			}
			a{
				text-decoration:none;
				-webkit-tap-highlight-color:rgba(0,0,0,0);
			}
			ul,li{
				list-style:none;
			}
			input{
				outline:none;
			}
			img{
				display: block;
			}
			html,body{
				height:100%;
				overflow:hidden;
			}
			#wrap{
				position:relative;
				width:100%;
				height:100%;
				overflow: hidden;
			}
			#wrap .header{
				width:100%;
				height:2rem;
				background-color:#333;
				color:#fff;
				text-align: center;
				line-height:2rem;
				font-size:.8rem;
				font-family:'宋体';
			}
			#wrap .contentWrap{
				overflow:hidden;
				position:absolute;
				left:0;
				right:0;
				top:2rem;
				bottom:0;
			}
			#wrap .contentWrap .content{
				position:relative;
			}
			#wrap .contentWrap .content .imgList{
				overflow: hidden;
			}
			#wrap .contentWrap .content .imgList li{
				float:left;
				width:7rem;
				height:7rem;
				margin:.5rem;
				background: url(img/loadingImg.gif) no-repeat center;
			}
			#wrap .contentWrap .content .imgList li img{
				width:100%;
				border-radius: 10px;
				opacity: 0;
				transition:opacity 3s;
			}
			#wrap .contentWrap .content .footer{
				position:absolute;
				left:0;
				bottom:-4rem;
				width:100%;
				height:4rem;
				font-family: '宋体';
				font-size:.8rem;
				text-align: center;
				line-height:4rem;
				
				transform: scale(0);
			}
		</style>
	</head>
	<body>
		<div id="wrap">
			<header class="header">三国女将</header>
			<div class="contentWrap">
				<div class="content">
					<ul class="imgList">
						
					</ul>
					<div class="footer">上滑加载更多</div>
				</div>
			</div>
		</div>
		<script src="js/transform.js"></script>
		<script src="js/drag.js"></script>
		<script type="text/javascript">
			!(function(){
				var width=document.documentElement.clientWidth;
				var styleNode=document.createElement('style');
				styleNode.innerHTML='html{font-size:'+width/16+'px !important;}';
				document.head.appendChild(styleNode);
			})();
			document.addEventListener('touchstart',function(e){
				e.preventDefault();
			});
			var aNodes=document.querySelectorAll('a');
			for (var i = 0; i < aNodes.length; i++) {
				aNodes[i].addEventListener('touchstart',function(){
					window.href=this.href;
				});
			}
			
			var imgArr=[];
			var imgList=document.querySelector('#wrap .contentWrap .content .imgList');
			var header=document.querySelector('#wrap .header');
			var contentWrap=document.querySelector('#wrap .contentWrap');
			var content=document.querySelector('#wrap .contentWrap .content');
			var isFooter=false;
			var footer=document.querySelector('#wrap .contentWrap .content .footer');
			for (var i = 0; i < 100; i++) {
				imgArr.push('img/'+(i%18+1)+'.jpg');
			}

			var start=0;
			var length=12;
			var end=0;
			createLi();
			function createLi(){
				end=start+length; 
				for (var i = start; i < end; i++) {
					var li=document.createElement('li');
					li.imgSrc=imgArr[i];
					li.imgLoad=false;
					imgList.appendChild(li);
				}
				start=end;
				lazyLoad();
			}
			
			function lazyLoad(){
				var liNodes=imgList.querySelectorAll('li');
				var h=header.offsetHeight;
				var H=document.documentElement.clientHeight;
				for (var i = 0; i < liNodes.length; i++) {
					var liTop=liNodes[i].getBoundingClientRect().top;
					
					if(!liNodes[i].imgLoad&&liTop>=h&&liTop<=H){
						
						createImg(liNodes[i]);
					}
				}
			}
			function createImg(liEle){
				liEle.imgLoad=true;
				var img=new Image();
				img.src=liEle.imgSrc;
				img.onload=function(){
					img.style.opacity=1;
				}
				liEle.appendChild(img);
			}
			
			var callback={
				start:function(){
					var h=contentWrap.clientHeight-content.offsetHeight;
					var H=transformCss(content,'translateY');
					if(Math.abs(h)<=Math.abs(H)){
						isFooter=true;
					}
				},
				move:function(){
					if(isFooter){
						var h=contentWrap.clientHeight-content.offsetHeight;
 						var H=transformCss(content,'translateY');
 						var footerH=Math.abs(H)-Math.abs(h);
 						var footerScale=footerH/footer.offsetHeight;
 						footerScale=footerScale>1?1:footerScale;
 						transformCss(footer,'scale',footerScale);
					}
					lazyLoad();
				}
			}
			contentDrag(contentWrap,callback);
		</script>
	</body>
</html>
